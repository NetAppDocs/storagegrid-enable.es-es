---
permalink: tools-apps-guides/elasticsearch-snapshot-configuration.html 
sidebar: sidebar 
keywords: Elastic, Elasticsearch, snapshot, repository, StorageGRID, object storage 
summary: Instrucciones para crear un repositorio de instantáneas de Elasticsearch para utilizar el almacenamiento de objetos StorageGRID . 
---
= Configuración del repositorio de instantáneas de Elasticsearch
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
_Por Angela Cheng_

Elasticsearch admite el uso de almacenamiento de objetos compatible con AWS S3 para repositorios de instantáneas.  Este artículo proporciona instrucciones paso a paso sobre cómo crear un repositorio de instantáneas de Elasticsearch S3 con StorageGRID como almacenamiento de objetos de back-end.



== Requisitos

* StorageGRID 11.8 o superior
* Elasticsearch 8.x o superior




== Suposición

Los lectores están familiarizados con la terminología y las operaciones de StorageGRID y Elasticsearch.



== Instrucción

* Pasos*

. Cree un depósito StorageGRID para utilizarlo en el repositorio de instantáneas de Elasticsearch.  El control de versiones del bucket debe estar habilitado.  Utilice un depósito por repositorio.  No comparta un depósito entre varios repositorios o clústeres de Elasticsearch.
. Agregue la clave de acceso del inquilino de StorageGRID y la clave secreta al almacén de claves de Elasticsearch.  Inicie sesión en el nodo maestro de Elasticsearch, navegue hasta el `<elasticsearch>/bin/` directorio y uso `elasticsearch-keystore` para agregar la clave de acceso y la clave secreta.
+
Comando de muestra:

+
[NOTE]
====
 In older Elasticsearch versions, the key names are `access.key` and `secret.key` instead of using underscores.
====
+
[listing]
----
/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.access_key
Enter value for s3.client.sgdemo.access_key: <paste the access key here, it will not be displayed>

/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.secret_key
Enter value for s3.client.sgdemo.secret_key: <paste the secret key here, it will not be displayed>
----
+
Para mostrar las claves, utilice el comando 'elasticsearch-keystore show <key-name>'.

. Para clústeres de Elasticsearch de varios nodos, repita el paso 2 en cada nodo o consulte la documentación de Elasticsearch.
. Desde la GUI web de Kibana, navegue a la página de la Consola de herramientas de desarrollo y use `POST _nodes/reload_secure_settings` API para aplicar los cambios a cada nodo.
+
image:es-snapshot/es-reload-api.png["Captura de pantalla de muestra de reload_secure_settings"]

. Utilice el `PUT _snapshot` API para crear un nuevo repositorio de instantáneas.
+
En este ejemplo, el nombre del repositorio es `sg_snapshot_repository` , y el tamaño del búfer corresponde al tamaño de la parte de carga multiparte de S3.

+
El protocolo predeterminado es HTTPS.  Para usar HTTP con el punto final StorageGRID S3, agregue `"protocol": "http"` a la configuración.

+
Utilice el nombre del depósito creado en el paso 1 y el nombre del cliente configurado en el paso 2.

+
[listing]
----
PUT _snapshot/sg_snapshot_repository
{
  "type": "s3",
  "settings": {
    "bucket": "elk-snapshot",
    "client": "sgdemo",
    "path_style_access": "true",
    "endpoint": "sgdemo.netapp.com",
    "buffer_size": "512mb"
  }
}
----
+
image:es-snapshot/es-create-repository-api.png["Captura de pantalla de muestra de la API de Elasticsearch"]

. Desde la GUI web de Kibana, navegue a la página Administración de pila > Instantánea y restauración, seleccione la pestaña Repositorios.
+
Haga clic en el nombre del repositorio para ver los detalles o modificar algunas configuraciones, como la cantidad máxima de bytes de instantáneas por segundo, cuyo valor predeterminado es 40 MB/s por nodo Elasticsearch.

+
Para configuraciones no visibles en esta página, utilice el `PUT _snapshot` API en la consola de herramientas de desarrollo para realizar cambios.

+
image:es-snapshot/es-snapshot-repository.png["Captura de pantalla de muestra del repositorio de instantáneas"]

. Configure una política de ciclo de vida del depósito para administrar objetos de versión no actual en el depósito de instantáneas.  Por ejemplo, eliminar versiones no actuales después de 90 días.
. Elastic requiere que los clientes validen el almacenamiento S3 que no es de AWS antes de usarlo para almacenar instantáneas.
+
Siga las instrucciones de Elastic para validar la configuración:

+
https://www.elastic.co/docs/api/doc/elasticsearch/operation/operation-snapshot-repository-analyze[]

. Después de la validación, sigue la guía de Elasticsearch para crear una política para almacenar instantáneas nocturnas.




== Recursos adicionales

* https://www.elastic.co/docs/api/doc/elasticsearch/group/endpoint-snapshot["Repositorio s3 de Elasticsearch"]
* https://docs.netapp.com/us-en/storagegrid/ilm/how-objects-are-deleted.html#delete-s3-versioned-objects["Cómo se eliminan los objetos versionados de S3"]

